{% extends "layouts/base.html" %}

{% block title %}·ª¶ng h·ªô - Donate{% endblock %}

{% block content %}
<div class="donate-container">
    <div class="donate-header">
        <h1>‚òï ·ª¶ng h·ªô duy tr√¨ website</h1>
        <p>N·∫øu b·∫°n th·∫•y website h·ªØu √≠ch, h√£y ·ªßng h·ªô ch√∫ng t√¥i m·ªôt ly c√† ph√™ ƒë·ªÉ duy tr√¨ v√† ph√°t tri·ªÉn th√™m nhi·ªÅu t√≠nh nƒÉng m·ªõi!</p>
    </div>

    <div class="donate-form-wrapper">
        <form id="donateForm" class="donate-form">
            <div class="amount-section">
                <label>Ch·ªçn s·ªë ti·ªÅn:</label>
                <div class="amount-buttons">
                    <button type="button" class="amount-btn" data-amount="10000">10,000ƒë</button>
                    <button type="button" class="amount-btn" data-amount="20000">20,000ƒë</button>
                    <button type="button" class="amount-btn" data-amount="50000">50,000ƒë</button>
                    <button type="button" class="amount-btn" data-amount="100000">100,000ƒë</button>
                    <button type="button" class="amount-btn" data-amount="200000">200,000ƒë</button>
                    <button type="button" class="amount-btn active" data-amount="custom">Kh√°c</button>
                </div>
                
                <div class="custom-amount">
                    <input type="number" 
                           id="customAmount" 
                           name="amount" 
                           placeholder="Nh·∫≠p s·ªë ti·ªÅn (t·ªëi thi·ªÉu 1,000ƒë)"
                           min="1000"
                           step="1000"
                           required>
                    <span class="currency">VNƒê</span>
                </div>
            </div>

            <div class="form-group">
                <label for="donorName">T√™n c·ªßa b·∫°n (t√πy ch·ªçn):</label>
                <input type="text" 
                       id="donorName" 
                       name="name" 
                       placeholder="Anonymous"
                       maxlength="100">
            </div>

            <div class="form-group">
                <label for="donorEmail">Email (t√πy ch·ªçn):</label>
                <input type="email" 
                       id="donorEmail" 
                       name="email" 
                       placeholder="your@email.com"
                       maxlength="100">
            </div>

            <div class="form-group">
                <label for="donorMessage">L·ªùi nh·∫Øn (t√πy ch·ªçn):</label>
                <textarea id="donorMessage" 
                          name="message" 
                          rows="3" 
                          placeholder="C·∫£m ∆°n b·∫°n ƒë√£ t·∫°o ra c√¥ng c·ª• h·ªØu √≠ch!"
                          maxlength="200"></textarea>
            </div>

            <button type="submit" class="donate-btn" id="submitBtn">
                <span class="btn-text">üíù ·ª¶ng h·ªô ngay</span>
                <span class="btn-loading" style="display: none;">‚è≥ ƒêang x·ª≠ l√Ω...</span>
            </button>
        </form>

        <div class="donate-info">
            <p>‚úÖ Thanh to√°n an to√†n qua PayOS</p>
            <p>‚úÖ H·ªó tr·ª£ QR Banking, V√≠ ƒëi·ªán t·ª≠</p>
            <p>‚úÖ Kh√¥ng l∆∞u th√¥ng tin th·∫ª</p>
        </div>
    </div>
</div>

<style>
.donate-container {
    max-width: 600px;
    margin: 40px auto;
    padding: 20px;
}

.donate-header {
    text-align: center;
    margin-bottom: 40px;
}

.donate-header h1 {
    font-size: 2em;
    margin-bottom: 15px;
    color: #2c3e50;
}

.donate-header p {
    color: #7f8c8d;
    line-height: 1.6;
}

.donate-form-wrapper {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.amount-section {
    margin-bottom: 25px;
}

.amount-section label {
    display: block;
    margin-bottom: 15px;
    font-weight: 600;
    color: #2c3e50;
}

.amount-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 15px;
}

.amount-btn {
    padding: 12px;
    border: 2px solid #e0e0e0;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}

.amount-btn:hover {
    border-color: #3498db;
    background: #f8f9fa;
}

.amount-btn.active {
    border-color: #3498db;
    background: #3498db;
    color: white;
}

.custom-amount {
    position: relative;
}

.custom-amount input {
    width: 100%;
    padding: 12px 60px 12px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
}

.custom-amount input:focus {
    outline: none;
    border-color: #3498db;
}

.custom-amount .currency {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #7f8c8d;
    font-weight: 600;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #3498db;
}

.donate-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s;
}

.donate-btn:hover {
    transform: translateY(-2px);
}

.donate-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.donate-info {
    margin-top: 25px;
    padding-top: 25px;
    border-top: 1px solid #e0e0e0;
    text-align: center;
}

.donate-info p {
    margin: 8px 0;
    color: #7f8c8d;
    font-size: 14px;
}

@media (max-width: 768px) {
    .donate-container {
        padding: 15px;
    }
    
    .donate-form-wrapper {
        padding: 20px;
    }
    
    .amount-buttons {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('donateForm');
    const amountBtns = document.querySelectorAll('.amount-btn');
    const customAmountInput = document.getElementById('customAmount');
    const submitBtn = document.getElementById('submitBtn');
    
    // Handle amount button clicks
    amountBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            amountBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const amount = this.dataset.amount;
            if (amount === 'custom') {
                customAmountInput.value = '';
                customAmountInput.focus();
            } else {
                customAmountInput.value = amount;
            }
        });
    });
    
    // Handle custom amount input
    customAmountInput.addEventListener('input', function() {
        amountBtns.forEach(b => b.classList.remove('active'));
        const customBtn = document.querySelector('[data-amount="custom"]');
        customBtn.classList.add('active');
    });
    
    // Handle form submission
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const amount = parseInt(customAmountInput.value);
        if (!amount || amount < 1000) {
            alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn t·ªëi thi·ªÉu 1,000 VNƒê');
            return;
        }
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.querySelector('.btn-text').style.display = 'none';
        submitBtn.querySelector('.btn-loading').style.display = 'inline';
        
        try {
            const response = await fetch('/api/donate/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    amount: amount,
                    name: document.getElementById('donorName').value || 'Anonymous',
                    email: document.getElementById('donorEmail').value,
                    message: document.getElementById('donorMessage').value
                })
            });
            
            const data = await response.json();
            
            if (data.success && data.checkoutUrl) {
                // Redirect to PayOS checkout
                window.location.href = data.checkoutUrl;
            } else {
                alert('L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ t·∫°o link thanh to√°n'));
                submitBtn.disabled = false;
                submitBtn.querySelector('.btn-text').style.display = 'inline';
                submitBtn.querySelector('.btn-loading').style.display = 'none';
            }
        } catch (error) {
            console.error('Error:', error);
            alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!');
            submitBtn.disabled = false;
            submitBtn.querySelector('.btn-text').style.display = 'inline';
            submitBtn.querySelector('.btn-loading').style.display = 'none';
        }
    });
});
</script>
{% endblock %}
